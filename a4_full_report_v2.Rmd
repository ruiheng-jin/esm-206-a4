---
title: "ESM 206 Assignment 4 Report"
author: "Ruiheng Jin and Qusai Bhaijeewala"
date: "11/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

```{r}

# attaching packages of tidyverse, janitor, and DT for data tables.
library(tidyverse)
library(janitor)
library(kableExtra)


# read in lobster abundance data
# change all the -99999 in the cells to na
# turn all the headers to snake case
lob_abun <- read_csv("lobster_abundance_sbc_lter.csv",
                     na = "-99999") %>% 
  clean_names()
```
## INTRODUCTION


## DATA AND METHODS


## RESULTS {.tabset .tabset-fade}

### RESULTS A
#### CHANGES IN ANNUAL LOBSTER ABUNDANCE AT FIVE SITES

```{r}
# data structure: each site has several transects, each transect has ABCD replicates

# uncount lobsters so each lobster has its own row
# Create a new row that says TRUE or FALSE for MPA Sites which are IVEE and NAPL
lob_tidy <- lob_abun %>% 
  tidyr::uncount(count) %>% 
  mutate(mpa = site %in% c("IVEE", "NAPL"))

# making a new column changing TRUE or FALSE to MPA and non-MPA
lob_tidy$mpa_status <- factor(lob_tidy$mpa, labels = c("non-MPA", "MPA"))

# making a new column that gives the full names of the sites so that we can use this column later in graphs

lob_tidy$site_name <- factor(lob_tidy$site, labels = c("Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk", "Naples"))

```

```{r}
# count total lobster count by year and site
lob_yr_site <- lob_tidy %>%
  count(year, site) %>% 
  mutate(mpa = site %in% c("IVEE", "NAPL"),
         mpa_status = factor(mpa, labels = c("non-MPA", "MPA")),
         site_name = factor(site, labels = c("Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk", "Naples")))  

ggplot(lob_yr_site, aes(x = year, y = n)) +
  facet_wrap(site_name~mpa_status) +
  geom_line(color = "#b62b2b", size = 1) +
  geom_point(color = "#4b1313", size = 2) +
  labs(x = "", 
       y = "Lobster abundance", 
       title = "Lobster Abundance at Five Sites (2012-2018)",
       caption = "Figure 1. Lobster abundance from 5 study sites, from year 2012 to 2018.") +
  scale_x_continuous(expand = expand_scale(add = c(1, 1)),
                     breaks = c(2012, 2014, 2016, 2018)) +
  scale_y_continuous(expand = expand_scale(add = c(0, 0)),
                     limits = c(0, 1000)) +
  theme_light() +
  theme(plot.caption = element_text(hjust = 0, size = 10),
        title = element_text(size = 13)) 
```


### RESULTS B
#### SHIFTS IN LOBSTER SIZE DISTRIBUTION FROM 2012 TO 2018

```{r}
# data structure: each site has several transects, and within each transect they have either A, B, C, or D replicates. The count column can has multiple counts of the same transect number and replicate, we want to make each of those counts a seperate row.

# uncount lobsters so each lobster has its own row
lob_tidy2 <- lob_abun %>% 
  tidyr::uncount(count) %>% 
  mutate(mpa = site %in% c("IVEE", "NAPL"))

# making a new column changing TRUE or FALSE to MPA and non-MPA
lob_tidy2$mpa_status <- factor(lob_tidy2$mpa, labels = c("non-MPA", "MPA"))
```

Marine Protected Areas (MPA) 
Sampling began in 2012 and is ongoing. Naples and Isla Vista

two within MPAs (Naples and Isla Vista) and three outside (Arroyo Quemado, Mohawk and Carpinteria).

```{r}

# Making a new column that gives the full names of the sites so that we can use this column later in graphs

lob_tidy2$site_name <- factor(lob_tidy2$site, labels = c("Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk", "Naples"))

# filtering years of 2012 and 2018 only
lob_size <- lob_tidy2 %>% 
  filter(year %in% c(2012,2018))

#graphing size distributions of lobster size at five sites from two years, 2012, 2018

ggplot(lob_size, aes(x = size_mm)) +
  geom_histogram(aes(fill = site_name)) +
  facet_grid(site ~ year, scales = "free_y") +
  theme_light() +
  theme(plot.caption = element_text(hjust = 0, size = 10),
        title = element_text(size = 13)) +
  labs(x = "Lobster size (mm)", 
         y = "Lobster Count", 
         fill = "Site Name",
       title = "Lobster size distributions observed at the 5 different sites \n in 2012 and 2018",
       caption = "Figure 2: This graph shows the size distributions of all the lobsters in 2012 and 2018 found in the five sites.")


```

There are two marine protected area (MPA), Naples and Isla Vista. These two sites have increased their lobster counts and the sizes of the lobsters as well. The sites of Mohalk and Carpenteria have also icreased in abundance and size. The site called Arroyo Quemado has the leased increase in spiny lobster size.


### RESULTS C
#### COMPARING MEAN LOBSTER SIZES AT MPA VS NON-MPA SITES IN 2012 AND 2018 

##### Making a summary table for comparing MPA vs. non-MPA, 2012 and 2018
```{r}

lob_c_sum <- lob_tidy2 %>% 
  filter(year %in% c(2012, 2018)) %>% 
  group_by(mpa_status, year) %>% 
  summarize(mean = mean(size_mm),
            sd = sd(size_mm),
            sample_size = n())

datatable(lob_c_sum)

lob_c_sum %>% 
  kable(col.names = c("MPA Status",
                      "Year",
                      "Mean Lobster Size (mm)",
                      "Standard Deviation",
                      "Sample Size")) %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left"
                ) %>%
  add_header_above(c("LOBSTER SIZE METRICS" = 5))
```
 ---------------------------------------------------------------
 --------------------------------------------------------------
 T: TESTS
 
 
 
```{r preparing data for t tests}
lob_mpa_2012 <- lob_tidy2 %>% 
  filter(year == "2012") %>% 
  filter(mpa_status == "MPA") %>% 
  pull(size_mm)
  
  
lob_mpa_2018 <- lob_tidy2 %>% 
  filter(year == "2018") %>% 
  filter(mpa_status == "MPA") %>% 
  pull(size_mm)

lob_non_mpa_2012 <- lob_tidy2 %>% 
  filter(year == "2012") %>% 
  filter(mpa_status == "non-MPA") %>% 
  pull(size_mm)


lob_non_mpa_2018 <- lob_tidy2 %>% 
  filter(year == "2018") %>% 
  filter(mpa_status == "non-MPA") %>% 
  pull(size_mm)


#mpa_12_18_ttest <- t.test(lob_mpa_2012, lob_mpa_2018)

#non_mpa_12_18_ttest <- t.test(lob_non_mpa_2012, lob_non_mpa_2018)



#lob_mpa_non_2012 <- t.test(lob_mpa_2012, lob_non_mpa_2012)


#lob_mpa_non_2018 <- t.test(lob_mpa_2018, lob_non_mpa_2018)
```


```{r}
#running 2 sample t test, we will run 4
# one for mpa site for 2012 and 2018, on for non mpa for 2012 and 2018, another for mpa and non mpa for 2012, and a mpa and non mpa for 2018


mpa_12_18_ttest <- t.test(lob_mpa_2012, lob_mpa_2018) #one for mpa site for 2012 and 2018,



non_mpa_12_18_ttest <- t.test(lob_non_mpa_2012, lob_non_mpa_2018) #one for non mpa for 2012 and 2018




lob_mpa_non_2012 <- t.test(lob_mpa_2012, lob_non_mpa_2012) # another for mpa and non mpa for 2012,



lob_mpa_non_2018 <- t.test(lob_mpa_2018, lob_non_mpa_2018) # mpa and non mpa for 2018
```


```{r}

# calculating cohen's d for mpa vs. non-mpa in 2012 and 2018

mpa_12_18_cohen <- effsize::cohen.d(lob_mpa_2012, lob_mpa_2018) # comparing mpa sites b/n 2012 and 2018

nonmpa_12_18_cohen <- effsize::cohen.d(lob_non_mpa_2012, lob_non_mpa_2018) # comparing non-mpa sites b/n 2012 and 2018

mpa_non_12 <- effsize::cohen.d(lob_mpa_2012, lob_non_mpa_2012) # comparing mpa sites and non-mpa sites in 2012

mpa_non_18 <- effsize::cohen.d(lob_mpa_2018, lob_non_mpa_2018) # comparing mpa sites and non-mpa sites in 2018

```


#### 1) TTest and Cohen's d for MPA sites in 2012 and 2018

```{r}
mpa_12_18_ttest
mpa_12_18_cohen
```


#### 2) TTest and Cohen's d for NON MPA sites in 2012 and 2018
```{r}
non_mpa_12_18_ttest
nonmpa_12_18_cohen
```

#### 3) TTest and Cohen's d for MPA and NON MPA sites in 2012

```{r}
lob_mpa_non_2012 
mpa_non_12
```

#### 4) TTest and Cohen's d for MPA and NON MPA sites in 2018

```{r}
lob_mpa_non_2018
mpa_non_18
```



```{r eval=FALSE, include=FALSE}
### ntrying to do T shits
lob_2012 <- lob_tidy2 %>% 
  filter(year == "2012") %>% 
  group_by(year, mpa_status) %>% 
  summarize(mean = mean(size_mm),
            sd = sd(size_mm),
            sample_size = n())

lob_2018 <- lob_tidy2 %>% 
  filter(year ==  "2018") %>% 
  group_by(year, mpa_status) %>% 
  summarize(mean = mean(size_mm),
            sd = sd(size_mm),
            sample_size = n())





```

```{r eval=FALSE, include=FALSE}
# more trying of T stuff

lob_t <- t.test(lob_2012$size_mm, lob_2018$size_mm)
```



## SUMMARY


## REFERENCE