---
title: "ESM 206 Assignment 4 Report"
author: "Qusai Bhaijeewala and Ruiheng Jin"
date: "11/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

```{r}

# attaching packages of tidyverse, janitor, and DT for data tables.
library(tidyverse)
library(janitor)
library(kableExtra)


# read in lobster abundance data
# change all the -99999 in the cells to na
# turn all the headers to snake case
lob_abun <- read_csv("lobster_abundance_sbc_lter.csv",
                     na = "-99999") %>% 
  clean_names()
```
## INTRODUCTION


## DATA AND METHODS
The data used in this report was collected by researchers from the Santa Barbara Coastal Long Term Ecological Research program (SBC LTER). The data includes observations of California spiny lobsters at five locations, two of which are Marine Protected Area (MPA). Three variables are studied in this report: year of observation, site of observation, size of lobster (mm). Two-sample, two-sided, unpaired tests (α = 0.05) and cohen’s d are performed for comparisons of mean lobster sizes between MPA sites and non-MPA sites, and between 2012 and 2018. Data analysis is performed using RStudio (Version 1.2.1335).

## RESULTS {.tabset .tabset-fade}

### RESULTS A
#### **CHANGES IN ANNUAL LOBSTER ABUNDANCE AT FIVE SITES**

```{r}
# data structure: each site has several transects, each transect has ABCD replicates

# uncount lobsters so each lobster has its own row
# Create a new row that says TRUE or FALSE for MPA Sites which are IVEE and NAPL
lob_tidy <- lob_abun %>% 
  tidyr::uncount(count) %>% 
  mutate(mpa = site %in% c("IVEE", "NAPL"))

# making a new column changing TRUE or FALSE to MPA and non-MPA
lob_tidy$mpa_status <- factor(lob_tidy$mpa, labels = c("non-MPA", "MPA"))

# making a new column that gives the full names of the sites so that we can use this column later in graphs

lob_tidy$site_name <- factor(lob_tidy$site, labels = c("Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk", "Naples"))

```

```{r}
# count total lobster count by year and site
lob_yr_site <- lob_tidy %>%
  count(year, site) %>% 
  mutate(mpa = site %in% c("IVEE", "NAPL"),
         mpa_status = factor(mpa, labels = c("non-MPA", "MPA")),
         site_name = factor(site, labels = c("Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk", "Naples")))  

ggplot(lob_yr_site, aes(x = year, y = n)) +
  facet_wrap(site_name~mpa_status) +
  geom_line(color = "#b62b2b", size = 1) +
  geom_point(color = "#4b1313", size = 2) +
  labs(x = "", 
       y = "Lobster abundance", 
       title = "Lobster Abundance at Five Sites (2012-2018)",
       caption = "Figure 1. Lobster abundance from 5 study sites, from year 2012 to 2018.") +
  scale_x_continuous(expand = expand_scale(add = c(1, 1)),
                     breaks = c(2012, 2014, 2016, 2018)) +
  scale_y_continuous(expand = expand_scale(add = c(0, 0)),
                     limits = c(0, 1000)) +
  theme_light() +
  theme(plot.caption = element_text(hjust = 0, size = 10),
        title = element_text(size = 11)) 
```

Isla Vista has the most noticable increase in lobster abundance from 2012 to 2018. Naples and Mohawk have similar increasing trends, although Naples experienced an increase between 2017 and 2018, while Mohawk a decrease. Carpinteria experienced a large increase between 2016 and 2017, but also a large decrease the following year. Arroyo Quemado's abundance remained low throughout the 2012-2018 period.

### RESULTS B
#### **SHIFTS IN LOBSTER SIZE DISTRIBUTION FROM 2012 TO 2018**

```{r}
# data structure: each site has several transects, and within each transect they have either A, B, C, or D replicates. The count column can has multiple counts of the same transect number and replicate, we want to make each of those counts a seperate row.

# uncount lobsters so each lobster has its own row
lob_tidy2 <- lob_abun %>% 
  tidyr::uncount(count) %>% 
  mutate(mpa = site %in% c("IVEE", "NAPL"))

# making a new column changing TRUE or FALSE to MPA and non-MPA
lob_tidy2$mpa_status <- factor(lob_tidy2$mpa, labels = c("non-MPA", "MPA"))
```

Marine Protected Areas (MPA) 
Sampling began in 2012 and is ongoing. Naples and Isla Vista

two within MPAs (Naples and Isla Vista) and three outside (Arroyo Quemado, Mohawk and Carpinteria).

```{r}

# Making a new column that gives the full names of the sites so that we can use this column later in graphs

lob_tidy2$site_name <- factor(lob_tidy2$site, labels = c("Arroyo Quemado", "Carpinteria", "Isla Vista", "Mohawk", "Naples"))

# filtering years of 2012 and 2018 only
lob_size <- lob_tidy2 %>% 
  filter(year %in% c(2012,2018))

#graphing size distributions of lobster size at five sites from two years, 2012, 2018

ggplot(lob_size, aes(x = size_mm)) +
  geom_histogram(aes(fill = site_name)) +
  facet_grid(site ~ year, scales = "free_y") +
  theme_light() +
  theme(plot.caption = element_text(hjust = 0, size = 10),
        title = element_text(size = 11)) +
  labs(x = "Lobster size (mm)", 
         y = "Lobster Count", 
         fill = "Site Name",
       title = "Lobster Size Distributions Observed at the 5 Different Sites in 2012 and 2018",
       caption = "Figure 2: This graph shows the size distributions of all the lobsters in 2012 and 2018 found in the five sites.")


```

There are two marine protected area (MPA), Naples and Isla Vista. These two sites have increased their lobster counts and the sizes of the lobsters as well. In 2012, Naples and IV sites had very little spiny lobster population and there was not that many variety of sizes either. The sites of Carpenteria increased almost as significantly in abundance and size as the two mpa sites. Mohald increased less in abundance, but shifted in size distribution. The site called Arroyo Quemado has the least increase in spiny lobster count, but became more abundant in bigger lobster.


### RESULTS C
#### **COMPARING MEAN LOBSTER SIZES AT MPA VS NON-MPA SITES IN 2012 AND 2018** 




```{r}
# creating a summary table for the average sizes of lobsters, the standard deviation, and sample size for mpa sites and non mpa sites for 2012 and 2018.

lob_c_sum <- lob_tidy2 %>% 
  filter(year %in% c(2012, 2018)) %>% 
  group_by(mpa_status, year) %>% 
  summarize(mean = mean(size_mm),
            sd = sd(size_mm),
            sample_size = n())

# makiing the table look nice

lob_c_sum %>% 
  kable(col.names = c("MPA Status",
                      "Year",
                      "Mean Lobster Size (mm)",
                      "Standard Deviation",
                      "Sample Size"),
        caption = "Table 1. Mean lobster size, standard deviation and sample size for MPA and non-MPA sites in 2012 and 2018.") %>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "left"
                ) %>%
  add_header_above(c("LOBSTER SIZE METRICS" = 5))
```

 
```{r preparing data for t tests}
# creating a data frame for lobster MPA sites in 2012
lob_mpa_2012 <- lob_tidy2 %>% 
  filter(year == "2012") %>% 
  filter(mpa_status == "MPA") %>% 
  pull(size_mm)
  
# creating a data frame for lobster MPA sites in 2018 
lob_mpa_2018 <- lob_tidy2 %>% 
  filter(year == "2018") %>% 
  filter(mpa_status == "MPA") %>% 
  pull(size_mm)

# creating a data frame for non MPA sites in 2012
lob_non_mpa_2012 <- lob_tidy2 %>% 
  filter(year == "2012") %>% 
  filter(mpa_status == "non-MPA") %>% 
  pull(size_mm)

# creating a data frame for non MPA sites in 2018
lob_non_mpa_2018 <- lob_tidy2 %>% 
  filter(year == "2018") %>% 
  filter(mpa_status == "non-MPA") %>% 
  pull(size_mm)



```


```{r}
# running four 2-sample t tests on lobster size
# 1) Ttest for mpa site for 2012 and 2018
# 2) Ttest for non mpa sites for 2012 and 2018 
# 3) Ttests for mpa and non mpa sites for 2012  
# 4) Ttest for mpa and non mpa sites for 2018


mpa_12_18_ttest <- t.test(lob_mpa_2012, lob_mpa_2018) # 1) Ttest for mpa site for 2012 and 2018



non_mpa_12_18_ttest <- t.test(lob_non_mpa_2012, lob_non_mpa_2018) # 2) Ttest for non mpa sites for 2012 and 2018



lob_mpa_non_2012 <- t.test(lob_mpa_2012, lob_non_mpa_2012) # 3) Ttests for mpa and non mpa sites for 2012  




lob_mpa_non_2018 <- t.test(lob_mpa_2018, lob_non_mpa_2018) # 4) Ttest for mpa and non mpa sites for 2018

```


```{r}

# calculating cohen's d for mpa vs. non-mpa in 2012 and 2018

mpa_12_18_cohen <- effsize::cohen.d(lob_mpa_2012, lob_mpa_2018) # comparing mpa sites b/n 2012 and 2018

nonmpa_12_18_cohen <- effsize::cohen.d(lob_non_mpa_2012, lob_non_mpa_2018) # comparing non-mpa sites b/n 2012 and 2018

mpa_non_12 <- effsize::cohen.d(lob_mpa_2012, lob_non_mpa_2012) # comparing mpa sites and non-mpa sites in 2012

mpa_non_18 <- effsize::cohen.d(lob_mpa_2018, lob_non_mpa_2018) # comparing mpa sites and non-mpa sites in 2018

```


#### 1) Mean lobster size at MPA sites in 2012 and 2018

```{r include = FALSE}
mpa_12_18_ttest
mpa_12_18_cohen
```
- Mean lobster sizes differ significantly at MPA sites between 2012 and 2018 (t(`r round(mpa_12_18_ttest$parameter, 2)`) = `r round(mpa_12_18_ttest$statistic, 2)`, p = `r round(mpa_12_18_ttest$p.value, 6)`). 
- The 95% confidence interval is (`r round(mpa_12_18_ttest$conf.int, 2)`). 
- The effect size is large (Cohen's d = `r round(mpa_12_18_cohen$estimate, 3)`). 
- Mean lobster sizes at MPA sites in 2012 and 2018 are `r round(mpa_12_18_ttest$estimate, 2)` mm, respectively.

#### 2) Mean lobster size at non-MPA sites in 2012 and 2018
```{r include = FALSE}
non_mpa_12_18_ttest
nonmpa_12_18_cohen
```
- Mean lobster sizes at non-MPA sites do not differ significantly between 2012 and 2018 (t(`r round(non_mpa_12_18_ttest$parameter, 2)`) = `r round(non_mpa_12_18_ttest$statistic, 2)`, p = `r round(non_mpa_12_18_ttest$p.value, 4)`). 
- The 95% confidence interval is (`r round(non_mpa_12_18_ttest$conf.int, 2)`). 
- The effect size is negligible (Cohen's d = `r round(nonmpa_12_18_cohen$estimate, 3)`). 
- Mean lobster sizes at non-MPA sites in 2012 and 2018 are `r round(non_mpa_12_18_ttest$estimate, 2)` mm, respectively.



#### 3) Mean lobster size at MPA and non-MPA sites in 2012

```{r include = FALSE}
lob_mpa_non_2012 
mpa_non_12
```
- Mean lobster sizes differ significantly between MPA and non-MPA sites in 2012 (t(`r round(lob_mpa_non_2012$parameter, 2)`) = `r round(lob_mpa_non_2012$statistic, 2)`, p = `r round(lob_mpa_non_2012$p.value, 4)`). 
- The 95% confidence interval is (`r round(lob_mpa_non_2012$conf.int, 2)`). 
- The effect size is medium (Cohen's d = `r round(mpa_non_12$estimate, 3)`). 
- In 2012, mean lobster sizes at MPA and non-MPA sites are `r round(lob_mpa_non_2012$estimate, 2)` mm, respectively.

#### 4) Mean lobster size at MPA and non-MPA sites in 2018

```{r include = FALSE}
lob_mpa_non_2018
mpa_non_18
```
- Mean lobster sizes differ significantly between MPA and non-MPA sites in 2012 (t(`r round(lob_mpa_non_2018$parameter, 2)`) = `r round(lob_mpa_non_2018$statistic, 2)`, p = `r round(lob_mpa_non_2018$p.value, 14)`). 
- The 95% confidence interval is (`r round(lob_mpa_non_2018$conf.int, 2)`). 
- The effect size is small (Cohen's d = `r round(mpa_non_18$estimate, 3)`). 
- In 2018, mean lobster sizes at MPA and non-MPA sites are `r round(lob_mpa_non_2018$estimate, 2)` mm, respectively.


## SUMMARY


## REFERENCE